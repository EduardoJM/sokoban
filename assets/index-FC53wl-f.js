var vs=Object.defineProperty;var y0=t=>{throw TypeError(t)};var gs=(t,e,i)=>e in t?vs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var x=(t,e,i)=>gs(t,typeof e!="symbol"?e+"":e,i),$e=(t,e,i)=>e.has(t)||y0("Cannot "+i);var s=(t,e,i)=>($e(t,e,"read from private field"),i?i.call(t):e.get(t)),h=(t,e,i)=>e.has(t)?y0("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),l=(t,e,i,n)=>($e(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),d=(t,e,i)=>($e(t,e,"access private method"),i);var je=(t,e,i,n)=>({set _(r){l(t,e,r,i)},get _(){return s(t,e,n)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=i(r);fetch(r.href,o)}})();var P,St,_t,k,F,ne,t0,_0,ws=(_0=class{constructor(t){h(this,ne);h(this,P);h(this,St);h(this,_t);x(this,"position",[0,0]);h(this,k);h(this,F);l(this,k,t.screenWidth),l(this,F,t.screenHeight),t.cameraWidth&&t.cameraHeight&&(l(this,St,t.cameraWidth),l(this,_t,t.cameraHeight),l(this,P,{left:(t.screenWidth-s(this,St))*.5,right:(t.screenWidth+s(this,St))*.5-1,top:(t.screenHeight-s(this,_t))*.5,bottom:(t.screenHeight+s(this,_t))*.5-1}))}update(t,e){let[i,n]=t;if(!s(this,P)||!s(this,k)||!s(this,F)){this.position[0]=Math.floor(i/s(this,k))*s(this,k),this.position[1]=Math.floor(n/s(this,F))*s(this,F),d(this,ne,t0).call(this,e);return}let[r,o]=this.position,a=i-r,u=n-o;a<s(this,P).left&&(this.position[0]-=s(this,P).left-a),a>s(this,P).right&&(this.position[0]+=a-s(this,P).right),u<s(this,P).top&&(this.position[1]-=s(this,P).top-u),u>s(this,P).bottom&&(this.position[1]+=u-s(this,P).bottom),d(this,ne,t0).call(this,e)}isOnScreen(t){let[e,i]=t,n=e-this.position[0],r=i-this.position[1];return n>=0&&r>=0&&n<s(this,k)&&r<s(this,F)}reset(){this.position=[0,0]}},P=new WeakMap,St=new WeakMap,_t=new WeakMap,k=new WeakMap,F=new WeakMap,ne=new WeakSet,t0=function(t){let[e,i]=t;this.position[0]=Math.max(0,Math.min(this.position[0],e-s(this,k))),this.position[1]=Math.max(0,Math.min(this.position[1],i-s(this,F)))},_0),bs=t=>new ws(t),Ts={player:{sprite:0},templates:{},map:`
		........
		........
		........
		........
		........
		........
		........
		........
	`,colors:["#212529","#f8f9fa","#ced4da","#228be6","#fa5252","#fcc419","#ff922b","#40c057","#f06595","#a52f01"],messageBackground:0,messageColor:1,dialogBackground:0,dialogColor:1,dialogBorder:1,screenWidth:8,screenHeight:8,cellWidth:8,cellHeight:8,background:1,volume:.5,controls:{LEFT:["KeyA","ArrowLeft"],RIGHT:["KeyD","ArrowRight"],UP:["KeyW","ArrowUp"],DOWN:["KeyS","ArrowDown"],ACTION:["Enter","Space"]}},c0=t=>t.trim().replace(/[ \t]/gm,"").split(/\n+/gm),qs=t=>{let e=t.length;return[Math.max(...t.map(i=>i.length)),e]},Es=t=>{try{return new URL(t),!0}catch{return!1}},v0="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),Q=(t,e)=>{if(t=`${t}`,t.length>1)return t;if(!v0.includes(t))return"transparent";let i=v0.findIndex(n=>n===t);return e[i]??"transparent"},zs=(...t)=>t.reduce((e,i)=>[e[0]+i[0],e[1]+i[1]],[0,0]),Ue=(...t)=>!t.some((e,i)=>{let n=t[i-1];return n?n[0]!==e[0]||n[1]!==e[1]:!1}),As=(t,e)=>{let i;return(...n)=>{let r;return i&&clearTimeout(i),i=setTimeout(()=>{r=t(...n)},e),r}};function Oe(){let t=0,e=new Map;return{subscribe(i){let n=t++;return e.set(n,i),()=>e.delete(n)},notify(i){e.forEach(n=>n(i))},clear(){e.clear()}}}var Cs=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[24,60,60,24,24,0,24,0],[54,54,0,0,0,0,0,0],[54,54,127,54,127,54,54,0],[12,62,3,30,48,31,12,0],[0,99,51,24,12,102,99,0],[28,54,28,110,59,51,110,0],[6,6,3,0,0,0,0,0],[24,12,6,6,6,12,24,0],[6,12,24,24,24,12,6,0],[0,102,60,255,60,102,0,0],[0,12,12,63,12,12,0,0],[0,0,0,0,0,12,12,6],[0,0,0,63,0,0,0,0],[0,0,0,0,0,12,12,0],[96,48,24,12,6,3,1,0],[62,99,115,123,111,103,62,0],[12,14,12,12,12,12,63,0],[30,51,48,28,6,51,63,0],[30,51,48,28,48,51,30,0],[56,60,54,51,127,48,120,0],[63,3,31,48,48,51,30,0],[28,6,3,31,51,51,30,0],[63,51,48,24,12,12,12,0],[30,51,51,30,51,51,30,0],[30,51,51,62,48,24,14,0],[0,12,12,0,0,12,12,0],[0,12,12,0,0,12,12,6],[24,12,6,3,6,12,24,0],[0,0,63,0,0,63,0,0],[6,12,24,48,24,12,6,0],[30,51,48,24,12,0,12,0],[62,99,123,123,123,3,30,0],[12,30,51,51,63,51,51,0],[63,102,102,62,102,102,63,0],[60,102,3,3,3,102,60,0],[31,54,102,102,102,54,31,0],[127,70,22,30,22,70,127,0],[127,70,22,30,22,6,15,0],[60,102,3,3,115,102,124,0],[51,51,51,63,51,51,51,0],[30,12,12,12,12,12,30,0],[120,48,48,48,51,51,30,0],[103,102,54,30,54,102,103,0],[15,6,6,6,70,102,127,0],[99,119,127,127,107,99,99,0],[99,103,111,123,115,99,99,0],[28,54,99,99,99,54,28,0],[63,102,102,62,6,6,15,0],[30,51,51,51,59,30,56,0],[63,102,102,62,54,102,103,0],[30,51,7,14,56,51,30,0],[63,45,12,12,12,12,30,0],[51,51,51,51,51,51,63,0],[51,51,51,51,51,30,12,0],[99,99,99,107,127,119,99,0],[99,99,54,28,28,54,99,0],[51,51,51,30,12,12,30,0],[127,99,49,24,76,102,127,0],[30,6,6,6,6,6,30,0],[3,6,12,24,48,96,64,0],[30,24,24,24,24,24,30,0],[8,28,54,99,0,0,0,0],[0,0,0,0,0,0,0,255],[12,12,24,0,0,0,0,0],[0,0,30,48,62,51,110,0],[7,6,6,62,102,102,59,0],[0,0,30,51,3,51,30,0],[56,48,48,62,51,51,110,0],[0,0,30,51,63,3,30,0],[28,54,6,15,6,6,15,0],[0,0,110,51,51,62,48,31],[7,6,54,110,102,102,103,0],[12,0,14,12,12,12,30,0],[48,0,48,48,48,51,51,30],[7,6,102,54,30,54,103,0],[14,12,12,12,12,12,30,0],[0,0,51,127,127,107,99,0],[0,0,31,51,51,51,51,0],[0,0,30,51,51,51,30,0],[0,0,59,102,102,62,6,15],[0,0,110,51,51,62,48,120],[0,0,59,110,102,6,15,0],[0,0,62,3,30,48,31,0],[8,12,62,12,12,44,24,0],[0,0,51,51,51,51,110,0],[0,0,51,51,51,30,12,0],[0,0,99,107,127,127,54,0],[0,0,99,54,28,54,99,0],[0,0,51,51,51,62,48,31],[0,0,63,25,12,38,63,0],[56,12,12,7,12,12,56,0],[24,24,24,0,24,24,24,0],[7,12,12,56,12,12,7,0],[110,59,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],Ps=[[0,0,0,0,0,0,0,0],[24,24,0,24,24,24,24,0],[24,24,126,3,3,126,24,24],[28,54,38,15,6,103,63,0],[0,0,99,62,54,62,99,0],[51,51,30,63,12,63,12,12],[24,24,24,0,24,24,24,0],[124,198,28,54,54,28,51,30],[51,0,0,0,0,0,0,0],[60,66,153,133,133,153,66,60],[60,54,54,124,0,0,0,0],[0,204,102,51,102,204,0,0],[0,0,0,63,48,48,0,0],[0,0,0,0,0,0,0,0],[60,66,157,165,157,165,66,60],[126,0,0,0,0,0,0,0],[28,54,54,28,0,0,0,0],[24,24,126,24,24,0,126,0],[28,48,24,12,60,0,0,0],[28,48,24,48,28,0,0,0],[24,12,0,0,0,0,0,0],[0,0,102,102,102,62,6,3],[254,219,219,222,216,216,216,0],[0,0,0,24,24,0,0,0],[0,0,0,0,0,24,48,30],[8,12,8,28,0,0,0,0],[28,54,54,28,0,0,0,0],[0,51,102,204,102,51,0,0],[195,99,51,189,236,246,243,3],[195,99,51,123,204,102,51,240],[3,196,99,180,219,172,230,128],[12,0,12,6,3,51,30,0],[7,0,28,54,99,127,99,0],[112,0,28,54,99,127,99,0],[28,54,0,62,99,127,99,0],[110,59,0,62,99,127,99,0],[99,28,54,99,127,99,99,0],[12,12,0,30,51,63,51,0],[124,54,51,127,51,51,115,0],[30,51,3,51,30,24,48,30],[7,0,63,6,30,6,63,0],[56,0,63,6,30,6,63,0],[12,18,63,6,30,6,63,0],[54,0,63,6,30,6,63,0],[7,0,30,12,12,12,30,0],[56,0,30,12,12,12,30,0],[12,18,0,30,12,12,30,0],[51,0,30,12,12,12,30,0],[63,102,111,111,102,102,63,0],[63,0,51,55,63,59,51,0],[14,0,24,60,102,60,24,0],[112,0,24,60,102,60,24,0],[60,102,24,60,102,60,24,0],[110,59,0,62,99,99,62,0],[195,24,60,102,102,60,24,0],[0,54,28,8,28,54,0,0],[92,54,115,123,111,54,29,0],[14,0,102,102,102,102,60,0],[112,0,102,102,102,102,60,0],[60,102,0,102,102,102,60,0],[51,0,51,51,51,51,30,0],[112,0,102,102,60,24,24,0],[15,6,62,102,102,62,6,15],[0,30,51,31,51,31,3,3],[7,0,30,48,62,51,126,0],[56,0,30,48,62,51,126,0],[126,195,60,96,124,102,252,0],[110,59,30,48,62,51,126,0],[51,0,30,48,62,51,126,0],[12,12,30,48,62,51,126,0],[0,0,254,48,254,51,254,0],[0,0,30,3,3,30,48,28],[7,0,30,51,63,3,30,0],[56,0,30,51,63,3,30,0],[126,195,60,102,126,6,60,0],[51,0,30,51,63,3,30,0],[7,0,14,12,12,12,30,0],[28,0,14,12,12,12,30,0],[62,99,28,24,24,24,60,0],[51,0,14,12,12,12,30,0],[27,14,27,48,62,51,30,0],[0,31,0,31,51,51,51,0],[0,7,0,30,51,51,30,0],[0,56,0,30,51,51,30,0],[30,51,0,30,51,51,30,0],[110,59,0,30,51,51,30,0],[0,51,0,30,51,51,30,0],[24,24,0,126,0,24,24,0],[0,96,60,118,126,110,60,6],[0,7,0,51,51,51,126,0],[0,56,0,51,51,51,126,0],[30,51,0,51,51,51,126,0],[0,51,0,51,51,51,126,0],[0,56,0,51,51,62,48,31],[0,0,6,62,102,62,6,0],[0,51,0,51,51,62,48,31]],Ss=[[45,0,12,12,12,44,24,0],[12,30,51,51,63,51,51,0],[63,102,102,62,102,102,63,0],[63,51,3,3,3,3,3,0],[8,28,28,54,54,99,127,0],[127,70,22,30,22,70,127,0],[127,99,49,24,76,102,127,0],[51,51,51,63,51,51,51,0],[28,54,99,127,99,54,28,0],[30,12,12,12,12,12,30,0],[103,102,54,30,54,102,103,0],[8,28,28,54,54,99,99,0],[99,119,127,127,107,99,99,0],[99,103,111,123,115,99,99,0],[127,99,0,62,0,99,127,0],[28,54,99,99,99,54,28,0],[127,54,54,54,54,54,54,0],[63,102,102,62,6,6,15,0],[0,1,2,4,79,144,160,64],[127,99,6,12,6,99,127,0],[63,45,12,12,12,12,30,0],[51,51,51,30,12,12,30,0],[24,126,219,219,219,126,24,0],[99,99,54,28,54,99,99,0],[219,219,219,126,24,24,60,0],[62,99,99,99,54,54,119,0],[51,0,30,12,12,12,30,0],[51,0,51,51,30,12,30,0],[112,0,110,59,19,59,110,0],[56,0,30,3,14,3,30,0],[56,0,31,51,51,51,51,48],[56,0,12,12,12,44,24,0],[45,0,51,51,51,51,30,0],[0,0,110,59,19,59,110,0],[0,30,51,31,51,31,3,3],[0,0,51,51,30,12,12,0],[56,12,24,62,51,51,30,0],[0,0,30,3,14,3,30,0],[0,63,6,3,3,30,48,28],[0,0,31,51,51,51,51,48],[0,0,30,51,63,51,30,0],[0,0,12,12,12,44,24,0],[0,0,51,27,15,27,51,0],[0,3,6,12,28,54,99,0],[0,0,102,102,102,62,6,3],[0,0,51,51,51,30,12,0],[30,3,14,3,3,30,48,28],[0,0,30,51,51,51,30,0],[0,0,127,54,54,54,54,0],[0,0,60,102,102,54,6,6],[0,0,62,3,3,30,48,28],[0,0,126,27,27,27,14,0],[0,0,126,24,24,88,48,0],[0,0,51,51,51,51,30,0],[0,0,118,219,219,126,24,0],[0,99,54,28,28,54,99,0],[0,0,219,219,219,126,24,0],[0,0,54,99,107,127,54,0]],_s=[[0,0,0,0,0,0,0,0],[4,63,4,60,86,77,38,0],[4,63,4,60,86,77,38,0],[0,0,0,17,33,37,2,0],[0,1,17,33,33,37,2,0],[0,28,0,28,34,32,24,0],[60,0,60,66,64,32,24,0],[28,0,62,16,56,36,98,0],[28,0,62,16,56,36,98,0],[36,79,4,60,70,69,34,0],[36,79,4,60,70,69,34,0],[4,36,79,84,82,18,9,0],[68,36,15,84,82,82,9,0],[8,31,8,63,28,2,60,0],[68,47,4,31,14,1,30,0],[16,8,4,2,4,8,16,0],[40,68,18,33,2,4,8,0],[0,34,121,33,33,34,16,0],[64,34,17,61,17,18,8,0],[0,0,60,0,2,2,60,0],[32,64,22,32,1,1,14,0],[16,126,16,60,2,2,28,0],[36,79,20,46,1,1,14,0],[0,2,2,2,66,34,28,0],[32,66,18,34,2,34,28,0],[16,126,24,20,24,16,12,0],[68,47,6,5,6,4,3,0],[32,114,47,34,26,2,28,0],[128,80,58,23,26,2,28,0],[30,8,4,127,8,4,56,0],[79,36,2,127,8,4,56,0],[2,15,2,114,2,9,113,0],[66,47,2,114,2,9,113,0],[8,126,8,60,64,64,56,0],[68,47,4,30,32,32,28,0],[0,0,0,28,34,32,28,0],[0,28,34,65,64,32,28,0],[64,32,30,33,32,32,28,0],[0,62,8,4,4,4,56,0],[0,62,72,36,4,4,56,0],[4,4,8,60,2,2,60,0],[68,36,8,60,2,2,60,0],[50,2,39,34,114,41,17,0],[0,2,122,2,10,114,2,0],[8,9,62,75,101,85,34,0],[4,7,52,76,102,84,36,0],[0,0,60,74,73,69,34,0],[0,34,122,34,114,42,18,0],[128,81,29,17,57,21,9,0],[64,177,93,17,57,21,9,0],[0,0,19,50,81,17,14,0],[64,32,3,50,81,17,14,0],[64,160,67,50,81,17,14,0],[28,0,8,42,73,16,12,0],[76,32,8,42,73,16,12,0],[76,160,72,10,41,72,12,0],[0,0,4,10,17,32,64,0],[32,64,20,42,17,32,64,0],[32,80,36,10,17,32,64,0],[125,17,125,17,57,85,9,0],[157,81,29,17,57,85,9,0],[93,177,93,17,57,85,9,0],[126,8,62,8,28,42,4,0],[0,7,36,36,126,37,18,0],[4,15,100,6,5,38,60,0],[0,9,61,74,75,69,42,0],[2,15,2,15,98,66,60,0],[0,0,18,31,34,18,4,0],[0,18,63,66,66,52,4,0],[0,0,17,61,83,57,17,0],[0,17,61,83,81,57,17,0],[0,8,56,8,28,42,4,0],[8,8,56,8,28,42,4,0],[30,0,2,58,70,66,48,0],[0,32,34,34,42,36,16,0],[31,8,60,66,73,84,56,0],[4,7,4,12,22,85,36,0],[63,16,8,60,66,65,48,0],[0,0,8,14,56,76,42,0],[4,7,4,60,70,69,36,0],[14,8,60,74,105,85,50,0],[6,60,66,57,4,54,73,0],[4,15,4,110,17,8,112,0],[8,8,4,12,86,82,33,0],[64,46,0,60,66,64,56,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[64,128,32,64,0,0,0,0],[64,160,64,0,0,0,0,0],[0,0,8,8,16,48,12,0],[32,64,20,36,8,24,6,0],[0,0,0,0,0,0,0,0]],Ms=[[255,255,255,255,0,0,0,0],[0,0,0,0,0,0,0,255],[0,0,0,0,0,0,255,255],[0,0,0,0,0,255,255,255],[0,0,0,0,255,255,255,255],[0,0,0,255,255,255,255,255],[0,0,255,255,255,255,255,255],[0,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255],[127,127,127,127,127,127,127,127],[63,63,63,63,63,63,63,63],[31,31,31,31,31,31,31,31],[15,15,15,15,15,15,15,15],[7,7,7,7,7,7,7,7],[3,3,3,3,3,3,3,3],[1,1,1,1,1,1,1,1],[240,240,240,240,240,240,240,240],[85,0,170,0,85,0,170,0],[85,170,85,170,85,170,85,170],[255,170,255,85,255,170,255,85],[255,0,0,0,0,0,0,0],[128,128,128,128,128,128,128,128],[0,0,0,0,15,15,15,15],[0,0,0,0,240,240,240,240],[15,15,15,15,0,0,0,0],[15,15,15,15,255,255,255,255],[15,15,15,15,240,240,240,240],[255,255,255,255,15,15,15,15],[255,255,255,255,240,240,240,240],[240,240,240,240,0,0,0,0],[240,240,240,240,15,15,15,15],[240,240,240,240,255,255,255,255]],Rs=[[0,4,8,127,3,63,3,127],[0,54,0,127,3,63,3,127],[0,31,6,62,102,102,102,54],[0,16,8,127,3,3,3,3],[0,62,99,3,15,3,99,62],[0,62,99,3,62,96,99,62],[0,126,24,24,24,24,24,126],[0,54,0,127,28,28,28,127],[0,120,96,96,96,99,99,62],[0,30,27,27,59,91,91,59],[0,27,27,27,63,91,91,59],[0,31,6,62,102,102,102,102],[0,16,8,99,51,31,51,99],[0,4,8,99,115,123,111,103],[0,20,8,99,54,60,24,15],[0,99,99,99,99,127,28,28],[0,28,54,99,99,127,99,99],[0,63,3,3,63,99,99,63],[0,63,99,99,63,99,99,63],[0,127,3,3,3,3,3,3],[0,62,54,54,54,54,127,99],[0,127,3,3,63,3,3,127],[0,107,107,62,28,62,107,107],[0,62,99,96,56,96,99,62],[0,99,115,123,107,111,103,99],[0,20,8,99,115,123,111,103],[0,99,51,27,15,27,51,99],[0,124,102,102,102,102,102,99],[0,99,119,127,107,99,99,99],[0,99,99,99,127,99,99,99],[0,62,99,99,99,99,99,62],[0,127,99,99,99,99,99,99],[0,63,99,99,63,3,3,3],[0,62,99,3,3,3,99,62],[0,126,24,24,24,24,24,24],[0,99,99,54,60,24,12,7],[0,8,62,107,107,107,62,8],[0,99,119,62,28,62,119,99],[0,51,51,51,51,51,127,96],[0,99,99,99,127,96,96,96],[0,107,107,107,107,107,107,127],[0,107,107,107,107,107,127,96],[0,7,6,62,102,102,102,62],[0,99,99,99,103,107,107,103],[0,3,3,3,63,99,99,63],[0,62,99,96,120,96,99,62],[0,57,109,109,111,109,109,57],[0,126,99,99,126,108,102,99],[0,0,0,62,96,126,99,126],[0,62,3,63,99,99,99,62],[0,0,0,63,99,63,99,63],[0,0,0,127,3,3,3,3],[0,0,0,62,54,54,127,99],[0,0,0,62,99,127,3,62],[0,0,0,107,107,62,107,107],[0,0,0,62,99,56,99,62],[0,0,0,99,115,123,111,103],[0,20,8,0,115,123,111,103],[0,0,0,99,51,31,51,99],[0,0,0,124,102,102,102,99],[0,0,0,99,119,127,107,99],[0,0,0,99,99,127,99,99],[0,0,0,62,99,99,99,62],[0,0,0,127,99,99,99,99],[0,0,0,63,99,63,3,3],[0,0,0,62,99,3,99,62],[0,0,0,126,24,24,24,24],[0,0,0,99,54,60,24,15],[0,0,8,62,107,107,62,8],[0,0,0,119,62,28,62,119],[0,0,0,51,51,51,127,96],[0,0,0,99,99,127,96,96],[0,0,0,107,107,107,107,127],[0,0,0,107,107,107,127,96],[0,0,0,7,6,62,102,62],[0,0,0,99,99,103,107,103],[0,0,0,3,3,63,99,63],[0,0,0,62,99,120,99,62],[0,0,0,57,109,111,109,57],[0,0,0,126,99,126,108,102],[0,4,8,62,99,127,3,62],[0,54,0,62,99,127,3,62],[0,15,6,62,102,102,102,48],[0,16,8,0,127,3,3,3],[0,0,0,62,99,15,99,62],[0,0,0,126,3,127,96,63],[0,24,0,30,24,24,24,127],[0,54,0,30,24,24,24,127],[0,96,0,96,96,96,99,62],[0,0,0,30,27,59,91,59],[0,0,0,27,27,63,91,59],[0,6,15,6,62,102,102,102],[0,16,8,0,99,51,31,115],[0,4,8,0,115,123,111,103],[0,20,8,0,54,60,24,15],[0,0,0,99,99,99,127,28],[0,54,65,65,93,73,62,20],[0,0,0,107,107,107,62,54],[0,4,31,4,60,100,100,60],[0,4,4,31,4,60,100,60],[0,51,91,27,63,27,91,51],[0,0,0,115,27,63,27,115],[0,8,28,54,99,127,107,107],[0,0,0,28,54,99,127,107],[0,17,57,109,69,127,85,85],[0,0,0,57,109,69,127,85],[0,127,99,54,8,62,107,107],[0,0,0,62,20,8,62,107],[0,125,69,41,17,63,85,85],[0,0,0,125,41,17,63,85],[0,99,115,51,51,51,30,12],[0,0,0,99,51,51,30,12],[0,99,115,51,51,51,30,12],[54,108,0,99,51,51,30,12],[0,62,99,3,3,30,24,24],[0,0,0,62,99,3,30,24],[0,64,104,48,90,12,22,2],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,6,15,6,62,102,102,62],[0,6,6,15,6,62,102,62],[0,63,99,107,63,19,3,3],[0,0,0,63,107,63,19,3],[0,64,127,3,3,3,3,3],[0,0,64,127,3,3,3,3],[0,126,6,6,31,6,6,6],[0,0,0,126,6,31,6,6],[0,63,3,63,99,99,96,63],[0,0,0,63,3,63,96,63],[0,107,62,28,62,107,107,64],[0,0,107,107,62,107,107,64],[0,62,99,56,99,62,8,12],[0,62,96,56,96,62,8,12],[0,115,27,15,27,51,99,64],[0,0,99,51,31,51,99,64],[0,97,53,29,15,29,53,97],[0,0,0,97,53,31,53,97],[0,98,55,26,14,26,50,98],[0,2,7,98,50,30,50,98],[0,103,54,30,14,30,54,102],[0,0,0,103,54,30,54,102],[0,51,51,63,51,51,115,64],[0,0,51,51,63,51,115,64],[0,115,51,51,63,51,51,51],[0,0,0,115,51,63,51,51],[0,15,9,57,73,73,73,32],[0,0,0,15,57,73,73,32],[0,38,81,81,81,81,33,94],[0,0,0,38,81,81,33,94],[0,62,99,3,99,62,8,12],[0,0,62,3,3,62,8,12],[0,126,24,24,24,24,56,32],[0,0,0,126,24,24,56,32],[0,102,102,102,60,24,24,24],[0,0,0,102,102,60,24,24],[0,99,99,99,54,28,127,28],[0,0,0,99,54,28,127,28],[0,119,62,28,62,119,99,64],[0,0,119,62,28,62,119,64],[0,47,34,34,34,34,126,64],[0,0,0,47,34,34,126,64],[0,51,51,63,48,48,112,64],[0,0,0,51,63,48,112,64],[0,99,107,107,127,104,104,96],[0,0,0,99,107,127,104,96],[0,3,3,63,99,99,99,99],[0,0,3,3,63,99,99,99],[0,56,108,109,127,12,76,56],[0,0,0,56,109,127,12,56],[0,56,108,109,127,12,56,16],[0,0,56,109,127,12,56,16],[0,126,24,24,24,24,24,126],[0,20,28,107,107,62,107,107],[0,20,28,0,107,62,107,107],[0,99,99,127,96,96,112,16],[0,0,0,99,127,96,112,16],[0,28,26,24,24,24,24,126],[0,20,28,28,54,99,127,99],[0,20,28,62,96,126,99,126],[0,54,0,28,54,99,127,99],[0,54,0,62,96,126,99,126],[0,124,30,27,123,31,27,123],[0,0,0,63,108,127,13,63],[0,20,28,127,3,31,3,127],[0,20,28,62,99,127,3,62],[0,30,51,96,127,99,54,28],[0,0,0,63,96,127,99,62],[0,30,51,96,127,99,54,28],[0,108,0,63,96,127,99,62],[0,54,0,107,107,62,107,107],[0,0,54,0,107,62,107,107],[0,62,99,96,56,96,99,62],[0,108,0,62,99,56,99,62],[0,63,48,24,56,99,99,62],[0,0,0,63,16,56,99,62],[0,62,0,99,115,123,111,103],[0,0,62,0,115,123,111,103],[0,54,0,99,115,123,111,103],[0,0,54,0,115,123,111,103],[0,54,0,62,99,99,99,62],[0,0,54,0,62,99,99,62],[0,62,99,99,127,99,99,62],[0,0,0,62,99,127,99,62],[0,62,99,99,127,99,99,62],[0,108,0,62,99,127,99,62],[0,62,99,96,120,96,99,62],[0,108,0,62,99,120,99,62],[0,62,0,99,54,60,24,15],[0,0,62,0,99,54,28,15],[0,54,0,99,54,60,24,15],[0,0,54,0,99,54,28,15],[0,20,20,99,54,60,24,15],[0,20,20,0,54,60,24,15],[0,54,0,99,99,127,96,96],[0,0,54,0,99,127,96,96],[0,127,3,3,3,3,7,4],[0,0,0,127,3,3,7,4],[0,99,99,99,103,107,107,103],[0,108,0,99,99,103,107,103]],Is=[{start:0,characters:Cs},{start:160,characters:Ps},{start:912,characters:Ss},{start:12352,characters:_s},{start:9600,characters:Ms},{start:1024,characters:Rs}],g0={"~":"waveY",_:"waveX","%":"shake","=":"shakeX","^":"shakeY","°":"blink"},Mt,re,oe,ae,le,I,X0,G0,Y0,e0,At,at,s0,K0,d0=(at=class{constructor(e,i,n){h(this,I);h(this,Mt);h(this,re);h(this,oe);h(this,ae);h(this,le);l(this,oe,e),l(this,ae,i),l(this,le,n),l(this,Mt,[{pattern:"\\\\.",type:"char",process:r=>r.charAt(1)},{pattern:d(this,I,e0).call(this,e),type:"char"},{pattern:"<.>",type:"color",process:r=>r.charAt(1)},{pattern:Object.keys(g0).map(d(this,I,e0)).join("|"),type:"effect",process:r=>g0[r]},{pattern:"[^\\n\\r\\t]",type:"char"}]),l(this,re,new RegExp(s(this,Mt).map(r=>`(${r.pattern})`).join("|"),"g"))}parseText(e,i){let n=d(this,I,X0).call(this,e),r=d(this,I,G0).call(this,n);return d(this,I,Y0).call(this,r,i)}draw(e,i,n,r,o){var a;for(let u=0;u<i.length;u++){let p=i[u];if(p===void 0)continue;let m=n+u*8,f=r,y=p.color?Q(p.color,s(this,le)):null;switch(y?e.fillStyle=y:e.fillStyle=s(this,ae),p.effect){case"waveY":f+=Math.floor(Math.sin(o*.01+u)*3);break;case"waveX":m+=Math.floor(Math.sin(o*.01+u)*2);break;case"shake":m+=Math.floor((Math.random()-.5)*2),f+=Math.floor((Math.random()-.5)*2);break;case"shakeX":m+=Math.floor((Math.random()-.5)*2);break;case"shakeY":f+=Math.floor((Math.random()-.5)*2);break;case"blink":Math.sin(o*.015)>0&&(e.fillStyle="transparent");break}d(a=at,At,s0).call(a,e,p.value,m,f)}}static text(e,i,n,r){var o;for(let a=0;a<i.length;a++){let u=i.charAt(a);d(o=at,At,s0).call(o,e,u,n+a*8,r)}}},Mt=new WeakMap,re=new WeakMap,oe=new WeakMap,ae=new WeakMap,le=new WeakMap,I=new WeakSet,X0=function(e){let i=e.matchAll(s(this,re)),n=[];for(let r of i){r.shift();let o=r.findIndex(m=>m!==void 0),{type:a,process:u}=s(this,Mt)[o],p=u?u(r[o]):r[o];n.push({value:p,type:a})}return n},G0=function(e){let i=[],n=[],r=[];for(let o=0;o<e.length;o++){let a=e[o];if(!a)continue;let{type:u,value:p}=a;if(u==="char"){let m=n[n.length-1],f=r[r.length-1];i.push({value:p,color:m,effect:f});continue}if(a.type==="color"){let m=n.lastIndexOf(p);m!==-1?n.splice(m,1):n.push(p);continue}if(a.type==="effect"){let m=r.lastIndexOf(p);m!==-1?r.splice(m,1):r.push(p)}}return i},Y0=function(e,i){var r;let n=[];t:for(;e.length>0;){let o=e.findIndex((a,u)=>a.value===s(this,oe)&&u<i);if(o!==-1){n.push(e.splice(0,o)),e.splice(0,1);continue}else if(e.length<=i){n.push(e),e=[];continue}for(let a=i;a>=0;a--)if(((r=e[a])==null?void 0:r.value)===" "){n.push(e.splice(0,a)),e.splice(0,1);continue t}n.push(e.splice(0,i))}return e.length>0&&n.push(e),n},e0=function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},At=new WeakSet,s0=function(e,i,n,r){let o=i.charCodeAt(0),a=d(this,At,K0).call(this,o);if(a)for(let u=0;u<8;u++){let p=a[u];if(p!==void 0)for(let m=0;m<8;m++)p&1<<m&&e.fillRect(n+m,r+u,1,1)}},K0=function(e){let i=Is.find(n=>e>=n.start&&e<n.start+n.characters.length);return i?i.characters[e-i.start]:null},h(at,At),at);function p0(t){let e=new Map;return(i,...n)=>{let r=e.get(i);if(r)return r;let o=t(...n);return e.set(i,o),o}}var he,M0,Ds=(M0=class{constructor({id:t,zIndex:e}){x(this,"element");h(this,he,()=>{let t=this.element.width<this.element.height?"vertical":"horizontal",e=Math.min(window.innerWidth,window.innerHeight),i=t==="horizontal"?e:e/this.element.height*this.element.width,n=t==="vertical"?e:e/this.element.width*this.element.height,r=(window.innerWidth-i)*.5,o=(window.innerHeight-n)*.5;this.element.style.setProperty("width",`${i}px`),this.element.style.setProperty("height",`${n}px`),this.element.style.setProperty("left",`${r}px`),this.element.style.setProperty("top",`${o}px`)});this.element=document.createElement("canvas"),this.element.style.setProperty("position","absolute"),this.element.style.setProperty("image-rendering","pixelated"),t&&this.element.classList.add(t),e&&this.element.style.setProperty("z-index",e.toString()),document.body.append(this.element),window.addEventListener("resize",s(this,he))}show(){this.element.style.setProperty("display","block")}hide(){this.element.style.setProperty("display","none")}setSize(t,e){this.element.width=t,this.element.height=e,s(this,he).call(this)}get2dCtx(){let t=this.element.getContext("2d");if(!t)throw new Error("failled to access context of the canvas");return t}getWebglCtx(){let t=this.element.getContext("webgl");if(!t)throw new Error("failled to access context of the canvas");return t}},he=new WeakMap,M0),Ls=p0(t=>new Ds(t)),Qt=t=>Ls(t.id,t),Os="odyc-dialog-canvas",ht=384,js=30,te=2,w0=28,b0=10,T0=8,q0=12,ks=8,ke=2,W,D,ue,ut,R,U,B,ct,ce,Rt,de,pe,me,xe,dt,pt,mt,xt,fe,Zt,$0,Ve,Z0,R0,Fs=(R0=class{constructor(t){h(this,Zt);h(this,W);h(this,D);h(this,ue);h(this,ut);h(this,R);h(this,U,[]);h(this,B,0);h(this,ct);h(this,ce,0);h(this,Rt);x(this,"isOpen",!1);h(this,de);h(this,pe);h(this,me);h(this,xe);h(this,dt);h(this,pt);h(this,mt);h(this,xt);h(this,fe,t=>{var i,n,r,o;if(l(this,ct,requestAnimationFrame(s(this,fe))),t-s(this,ce)<(s(this,xe)||js))return;l(this,ce,t),((i=s(this,R))==null?void 0:i.length)===0&&s(this,B)<te-1&&(je(this,B)._++,l(this,R,(n=s(this,ut))==null?void 0:n.shift()));let e=(r=s(this,R))==null?void 0:r.shift();e&&((o=s(this,U)[s(this,B)])==null||o.push(e)),s(this,Ve).call(this,t)});h(this,Ve,t=>{d(this,Zt,Z0).call(this);let e=s(this,mt)+T0;for(let i=0;i<s(this,U).length;i++){let n=s(this,U)[i];if(!n)continue;let r=s(this,xt)+q0+8*i+i*b0;s(this,Rt).draw(s(this,D),n,e,r,t)}});l(this,de,Q(t.dialogBackground,t.colors)),l(this,pe,Q(t.dialogColor,t.colors)),l(this,me,Q(t.dialogBorder,t.colors)),l(this,xe,t.dialogInternvalMs),l(this,W,Qt({id:Os,zIndex:10})),s(this,W).setSize(ht,ht),s(this,W).hide(),l(this,D,s(this,W).get2dCtx()),l(this,pt,w0*8+T0*2),l(this,dt,te*ks+q0*2+b0*(te-1)),l(this,mt,(ht-s(this,pt))*.5),l(this,xt,ht-s(this,dt)-Math.floor(ht/15)),l(this,Rt,new d0("|",s(this,pe),t.colors))}async open(t){if(!(t.length<=0))return this.isOpen=!0,s(this,W).show(),l(this,ut,s(this,Rt).parseText(t,w0)),l(this,R,s(this,ut).shift()),l(this,U,new Array(te).fill(null).map(e=>[])),l(this,ct,requestAnimationFrame(s(this,fe))),new Promise(e=>{l(this,ue,()=>e())})}next(){var t;s(this,R)&&s(this,R).length>0||s(this,B)<te-1||(l(this,R,(t=s(this,ut))==null?void 0:t.shift()),l(this,B,0),l(this,U,s(this,U).map(()=>[])),s(this,R)===void 0&&d(this,Zt,$0).call(this))}},W=new WeakMap,D=new WeakMap,ue=new WeakMap,ut=new WeakMap,R=new WeakMap,U=new WeakMap,B=new WeakMap,ct=new WeakMap,ce=new WeakMap,Rt=new WeakMap,de=new WeakMap,pe=new WeakMap,me=new WeakMap,xe=new WeakMap,dt=new WeakMap,pt=new WeakMap,mt=new WeakMap,xt=new WeakMap,fe=new WeakMap,Zt=new WeakSet,$0=function(){var t;this.isOpen=!1,s(this,W).hide(),l(this,B,0),(t=s(this,ue))==null||t.call(this),s(this,ct)&&cancelAnimationFrame(s(this,ct))},Ve=new WeakMap,Z0=function(){s(this,D).clearRect(0,0,ht,ht),s(this,D).fillStyle=s(this,me),s(this,D).fillRect(s(this,mt)-ke,s(this,xt)-ke,s(this,pt)+ke*2,s(this,dt)+ke*2),s(this,D).fillStyle=s(this,de),s(this,D).fillRect(s(this,mt),s(this,xt),s(this,pt),s(this,dt))},R0),Ws=t=>new Fs(t),Us=({gameState:t,messageBox:e,camera:i})=>{let n=!1;return{play:async(...r)=>{r.length&&e.open(r),n=!0,i.reset(),t.turn.reset(),t.player.restoreSavedState(),t.actors.initActors()},get ending(){return n},set ending(r){n=r}}},E0=`attribute vec2 a_position;
varying vec2 v_texCoords;
void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);
    v_texCoords = a_position * vec2(0.5, -0.5) + 0.5;
}
`,z0=`precision mediump float;
varying vec2 v_texCoords;
uniform sampler2D u_texture;

void main() {
    gl_FragColor = texture2D(u_texture, v_texCoords);
}
`,Bs=`precision mediump float;
varying vec2 v_texCoords;
uniform sampler2D u_texture;
uniform vec2 u_size;
uniform float u_sideCount;
uniform float u_scale;
uniform float u_rotation;

#define PI 3.14159265359
#define TWO_PI 6.28318530718
#define CELL_SIZE 24.

void main() {
    float d = 0.0;
    vec2 uv = fract(v_texCoords * (u_size / CELL_SIZE));
    vec2 st = uv * 2. - 1.;

    float a = atan(st.x, st.y) + PI + u_rotation * TWO_PI;
    float r = TWO_PI / float(u_sideCount);

    d = cos(floor(.5 + a / r) * r - a) * length(st);

    float threshold = 1.0 - step(u_scale, d);
    gl_FragColor = texture2D(u_texture, v_texCoords) * threshold;
}
`,Hs=`precision mediump float;
varying vec2 v_texCoords;

uniform sampler2D u_texture;
uniform vec2 u_size;

uniform float u_warp;
uniform float u_lineWidth;
uniform float u_lineIntensity;
uniform float u_lineCount;

void main() {
    vec2 fragCoord = v_texCoords * u_size;
    vec2 uv = v_texCoords;

    vec2 dc = abs(0.5 - uv);
    dc *= dc;

    uv.x -= 0.5;
    uv.x *= 1.0 + dc.y * (0.3 * u_warp);
    uv.x += 0.5;

    uv.y -= 0.5;
    uv.y *= 1.0 + dc.x * (0.4 * u_warp);
    uv.y += 0.5;

    if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
        gl_FragColor = vec4(0.0);
    } else {
        float dist = abs(fract(uv.y * u_lineCount) - 0.5);
        float scanLine = min(step(u_lineWidth * .5, dist) + (1. - u_lineIntensity), 1.);

        vec3 color = texture2D(u_texture, uv).rgb;
        gl_FragColor = vec4(color * scanLine, 1.0);
    }
}
`,Vs=`precision mediump float;

varying vec2 v_texCoords;
uniform sampler2D u_texture;
uniform vec2 u_size;

uniform float u_scale;
uniform float u_intensity;

#define PI 3.14159265359
#define TWO_PI 6.28318530718
#define CELL_SIZE 24.

float mosaic(float scale) {
    float d = 0.0;
    vec2 uv = fract(v_texCoords * (u_size / CELL_SIZE));
    vec2 st = uv * 2. - 1.;

    float a = atan(st.x, st.y) + PI;
    float r = TWO_PI / 4.;

    d = cos(floor(.5 + a / r) * r - a) * length(st);

    return 1.0 - step(scale, d);
}

vec3 blur() {
    vec2 radius = CELL_SIZE / u_size;
    vec3 blur = vec3(0);
    float count = 0.;

    for (int j = 0; j < 16; j++) {
        float d = float(j) * TWO_PI / 16.;
        vec2 offset = vec2(cos(d), sin(d)) / (u_size / CELL_SIZE);
        blur += texture2D(u_texture, v_texCoords + offset).rgb;
        count++;
    }

    return blur / count;
}

void main() {
    vec3 color = texture2D(u_texture, v_texCoords).rgb;

    vec3 with_blur = mix(color, blur(), u_intensity);
    gl_FragColor = vec4(max(color, with_blur), 1.) * mosaic(u_scale);
}
`,Ze={fractal:{fragment:Bs,settings:{sideCount:12,scale:.9,rotation:0}},crt:{fragment:Hs,settings:{warp:.7,lineIntensity:.2,lineWidth:.6,lineCount:85}},neon:{fragment:Vs,settings:{scale:.75,intensity:.8}}},Ns=t=>{if("name"in t){let e=Object.assign({},Ze[t.name].settings,t.settings);return{vertex:Ze[t.name].vertex??E0,fragment:Ze[t.name].fragment??z0,settings:e}}return{vertex:t.vertex??E0,fragment:t.fragment??z0,settings:t.settings}},Q0="odyc-filter-canvas",H,ft,V,c,yt,ye,ve,It,Dt,T,i0,J0,ts,es,ss,is,n0,I0,Xs=(I0=class{constructor(t,e){h(this,T);x(this,"canvas");h(this,H);h(this,ft,{});h(this,V);h(this,c);h(this,yt);h(this,ye);h(this,ve);h(this,It,new Map);h(this,Dt);var o;if(l(this,H,Ns(e)),s(this,H).settings)for(let a in s(this,H).settings){let u=(o=s(this,H).settings)==null?void 0:o[a];s(this,ft)[a]=Array.isArray(u)?[...u]:u}l(this,V,t),this.canvas=Qt({id:Q0});let i=this.canvas.getWebglCtx();if(!i)throw new Error("WebGL not supported");l(this,c,i);let n=d(this,T,i0).call(this,s(this,c).VERTEX_SHADER,s(this,H).vertex),r=d(this,T,i0).call(this,s(this,c).FRAGMENT_SHADER,s(this,H).fragment);l(this,yt,d(this,T,J0).call(this,n,r)),s(this,c).useProgram(s(this,yt)),l(this,Dt,s(this,c).getAttribLocation(s(this,yt),"a_position")),l(this,ve,d(this,T,ts).call(this)),l(this,ye,d(this,T,es).call(this)),s(this,V).style.setProperty("display","none")}render(){this.canvas.show(),this.canvas.setSize(s(this,V).width,s(this,V).height),d(this,T,n0).call(this,"size",[this.canvas.element.width,this.canvas.element.height]),s(this,ft)&&Object.entries(s(this,ft)).forEach(([t,e])=>{d(this,T,n0).call(this,t,e)}),s(this,c).viewport(0,0,this.canvas.element.width,this.canvas.element.height),s(this,c).clearColor(0,0,0,1),s(this,c).clear(s(this,c).COLOR_BUFFER_BIT),d(this,T,ss).call(this),s(this,c).bindBuffer(s(this,c).ARRAY_BUFFER,s(this,ve)),s(this,c).enableVertexAttribArray(s(this,Dt)),s(this,c).vertexAttribPointer(s(this,Dt),2,s(this,c).FLOAT,!1,0,0),s(this,c).drawArrays(s(this,c).TRIANGLES,0,6)}setUniforms(t){for(let[e,i]of Object.entries(t))s(this,ft)[e]=Array.isArray(i)?[...i]:i}},H=new WeakMap,ft=new WeakMap,V=new WeakMap,c=new WeakMap,yt=new WeakMap,ye=new WeakMap,ve=new WeakMap,It=new WeakMap,Dt=new WeakMap,T=new WeakSet,i0=function(t,e){let i=s(this,c).createShader(t);if(s(this,c).shaderSource(i,e),s(this,c).compileShader(i),!s(this,c).getShaderParameter(i,s(this,c).COMPILE_STATUS)){let n=s(this,c).getShaderInfoLog(i);throw s(this,c).deleteShader(i),new Error(`Shader compilation failed:
${n}`)}return i},J0=function(t,e){let i=s(this,c).createProgram();if(s(this,c).attachShader(i,t),s(this,c).attachShader(i,e),s(this,c).linkProgram(i),!s(this,c).getProgramParameter(i,s(this,c).LINK_STATUS)){let n=s(this,c).getProgramInfoLog(i);throw s(this,c).deleteProgram(i),new Error(`Program link failed:
${n}`)}if(s(this,c).validateProgram(i),!s(this,c).getProgramParameter(i,s(this,c).VALIDATE_STATUS))throw new Error("validating program"+s(this,c).getProgramInfoLog(i));return i},ts=function(){let t=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),e=s(this,c).createBuffer();if(s(this,c).bindBuffer(s(this,c).ARRAY_BUFFER,e),s(this,c).bufferData(s(this,c).ARRAY_BUFFER,t,s(this,c).STATIC_DRAW),s(this,c).bindBuffer(s(this,c).ARRAY_BUFFER,null),!e)throw new Error("failed to create quad");return e},es=function(){let t=s(this,c).createTexture();if(s(this,c).bindTexture(s(this,c).TEXTURE_2D,t),s(this,c).texParameteri(s(this,c).TEXTURE_2D,s(this,c).TEXTURE_WRAP_S,s(this,c).CLAMP_TO_EDGE),s(this,c).texParameteri(s(this,c).TEXTURE_2D,s(this,c).TEXTURE_WRAP_T,s(this,c).CLAMP_TO_EDGE),s(this,c).texParameteri(s(this,c).TEXTURE_2D,s(this,c).TEXTURE_MIN_FILTER,s(this,c).NEAREST),s(this,c).texParameteri(s(this,c).TEXTURE_2D,s(this,c).TEXTURE_MAG_FILTER,s(this,c).NEAREST),s(this,c).texImage2D(s(this,c).TEXTURE_2D,0,s(this,c).RGBA,s(this,c).RGBA,s(this,c).UNSIGNED_BYTE,s(this,V)),s(this,c).bindTexture(s(this,c).TEXTURE_2D,null),!t)throw new Error("failed to create texture");return t},ss=function(){s(this,c).bindTexture(s(this,c).TEXTURE_2D,s(this,ye)),s(this,c).texImage2D(s(this,c).TEXTURE_2D,0,s(this,c).RGBA,s(this,c).RGBA,s(this,c).UNSIGNED_BYTE,s(this,V))},is=function(t){let e=`u_${t}`;if(s(this,It).has(e))return s(this,It).get(e);let i=s(this,c).getUniformLocation(s(this,yt),e);return i&&s(this,It).set(e,i),i},n0=function(t,e){let i=d(this,T,is).call(this,t);if(i){if(typeof e=="number"&&(e=[e]),e.length<1||e.length>4)throw new Error("setUniform supports 1–4 float values");switch(e.length){case 1:s(this,c).uniform1f(i,e[0]);break;case 2:s(this,c).uniform2f(i,e[0],e[1]);break;case 3:s(this,c).uniform3f(i,e[0],e[1],e[2]);break;case 4:s(this,c).uniform4f(i,e[0],e[1],e[2],e[3]);break}}},I0),Gs=(t,e)=>e?new Xs(t,e):(Qt({id:Q0}).hide(),null),Ys=(t,e,i,n,r,o)=>({player:t.player.facade,getCell:(a,u)=>t.actors.getCell(a,u),addToCell:(a,u,p)=>t.actors.addToCell(a,u,p),setCell:(a,u,p)=>t.actors.setCell(a,u,p),getAll:a=>t.actors.getAll(a),setAll:(a,u)=>t.actors.setAll(a,u),openDialog:a=>e.open(a),prompt:(...a)=>i.open(...a),openMenu:a=>i.openMenu(a),openMessage:(...a)=>o.open(a),playSound:(...a)=>n.play(...a),end:(...a)=>r.play(...a),loadMap:(a,u)=>{u&&(t.player.position=[...u]),t.gameMap.map=a,t.player.saveCurrentState()},updateFilter:a=>{t.filterUniforms.set(a)},get width(){return t.gameMap.dimensions[0]},get height(){return t.gameMap.dimensions[1]},get turn(){return t.turn.value}}),b,ge,we,N,O,ns,rs,os,as,D0,Ks=(D0=class{constructor(t){h(this,O);h(this,b);h(this,ge);h(this,we);h(this,N);l(this,b,t.gameState),l(this,ge,t.soundPlayer),l(this,we,t.dialog),l(this,N,t.ender)}async update(t){var n,r,o,a;s(this,N).ending=!1,s(this,b).player.setDirection(t);let e=s(this,b).player.position,i=zs(e,$s[t]);if(d(this,O,as).call(this,i)){let u=s(this,b).actors.getCell(...i);u.solid||(await((n=s(this,b).actors.getEvent(...e,"onLeave"))==null?void 0:n()),s(this,b).player.position=i),d(this,O,ns).call(this,u),await d(this,O,rs).call(this,u),u.solid?await((r=s(this,b).actors.getEvent(...i,"onCollide"))==null?void 0:r()):await((o=s(this,b).actors.getEvent(...i,"onEnter"))==null?void 0:o())}for(let u of s(this,b).actors.get())await((a=s(this,b).actors.getEvent(...u.position,"onTurn"))==null?void 0:a());s(this,b).player.dispatchOnTurn(),s(this,N).ending||s(this,b).turn.next(),await d(this,O,os).call(this,s(this,b).actors.getCell(...i))}},b=new WeakMap,ge=new WeakMap,we=new WeakMap,N=new WeakMap,O=new WeakSet,ns=function(t){let e=t.sound;if(e){let i=Array.isArray(e)?e:[e];s(this,ge).play(...i)}},rs=async function(t){t.dialog&&await s(this,we).open(t.dialog)},os=async function(t){let e=t.end;e&&(typeof e=="string"?await s(this,N).play(e):typeof e=="boolean"&&e?s(this,N).play():await s(this,N).play(...e))},as=function([t,e]){return t>=0&&e>=0&&t<s(this,b).gameMap.dimensions[0]&&e<s(this,b).gameMap.dimensions[1]},D0),$s={LEFT:[-1,0],RIGHT:[1,0],UP:[0,-1],DOWN:[0,1],ACTION:[0,0]},Zs=t=>new Ks(t),vt,gt,v,M,J,L0,A0=(L0=class{constructor(t,e){h(this,v);h(this,vt);h(this,gt);l(this,vt,t),l(this,gt,e)}get sprite(){var t;return((t=d(this,v,M).call(this))==null?void 0:t.sprite)??null}set sprite(t){d(this,v,J).call(this,"sprite",t)}get solid(){var t;return((t=d(this,v,M).call(this))==null?void 0:t.solid)??!1}set solid(t){d(this,v,J).call(this,"solid",t)}get sound(){var t;return((t=d(this,v,M).call(this))==null?void 0:t.sound)??null}set sound(t){d(this,v,J).call(this,"sound",t)}get position(){var t;return((t=d(this,v,M).call(this))==null?void 0:t.position)??[-1,-1]}get dialog(){var t;return((t=d(this,v,M).call(this))==null?void 0:t.dialog)??null}set dialog(t){d(this,v,J).call(this,"dialog",t)}get visible(){var t;return((t=d(this,v,M).call(this))==null?void 0:t.visible)??!1}set visible(t){d(this,v,J).call(this,"visible",t)}get foreground(){var t;return((t=d(this,v,M).call(this))==null?void 0:t.foreground)??!1}set foreground(t){d(this,v,J).call(this,"foreground",t)}get end(){var t;return((t=d(this,v,M).call(this))==null?void 0:t.end)??null}set end(t){d(this,v,J).call(this,"end",t)}get symbol(){var t;return((t=d(this,v,M).call(this))==null?void 0:t.symbol)??null}get isOnScreen(){var t;return((t=d(this,v,M).call(this))==null?void 0:t.isOnScreen)??!1}remove(){s(this,gt).clearCell(...s(this,vt))}},vt=new WeakMap,gt=new WeakMap,v=new WeakSet,M=function(){return s(this,gt).get().find(t=>Ue(t.position,s(this,vt)))},J=function(t,e){s(this,gt).setCell(...s(this,vt),{[t]:e})},L0),g,be,Lt,X,j,ls,r0,o0,O0,Qs=(O0=class{constructor(t,e){h(this,j);h(this,g,[]);h(this,be);h(this,Lt);h(this,X);l(this,be,e),l(this,Lt,t.templates),l(this,X,Oe()),this.initActors(),e.subscribe(()=>this.initActors())}subscribe(t){s(this,X).subscribe(t)}getAll(t){return s(this,g).filter(e=>e.symbol===t).map(e=>new A0(e.position,this))}setAll(t,e){for(let i=0;i<s(this,g).length;i++){let n=s(this,g)[i];if((n==null?void 0:n.symbol)!==t)continue;let r=Object.assign({},n,e);s(this,g)[i]=r}s(this,X).notify()}setCell(t,e,i){for(let n=0;n<s(this,g).length;n++){let r=s(this,g)[n];if(r&&r.position&&Ue(r.position,[t,e])){let o=Object.assign({},r,i);s(this,g)[n]=o;break}}s(this,X).notify()}addToCell(t,e,i){let n=d(this,j,o0).call(this,s(this,Lt),i);n&&(l(this,g,[...s(this,g).filter(r=>!Ue([t,e],r.position)),d(this,j,r0).call(this,t,e,i,n)]),s(this,X).notify())}getCell(t,e){return new A0([t,e],this)}clearCell(t,e){l(this,g,s(this,g).filter(i=>!Ue(i.position,[t,e]))),s(this,X).notify()}getEvent(t,e,i){var r;let n=(r=s(this,g).find(o=>o.position[0]===t&&o.position[1]===e))==null?void 0:r[i];if(n)return()=>n(this.getCell(t,e))}get(){return s(this,g)}handleScreenEvents(t){let e=[],i=[];for(let n=0;n<s(this,g).length;n++){let r=s(this,g)[n];if(!r)continue;let o=t.isOnScreen(r.position);r.isOnScreen!==o&&(s(this,g)[n].isOnScreen=o,o?i.push(this.getEvent(...r.position,"onScreenEnter")):e.push(this.getEvent(...r.position,"onScreenLeave")))}e.forEach(n=>{n&&n()}),i.forEach(n=>{n&&n()})}initActors(){l(this,g,d(this,j,ls).call(this,c0(s(this,be).map),s(this,Lt)))}},g=new WeakMap,be=new WeakMap,Lt=new WeakMap,X=new WeakMap,j=new WeakSet,ls=function(t,e){let i=[];for(let n=0;n<t.length;n++){let r=t[n];if(r)for(let o=0;o<r.length;o++){let a=r[o];if(!a)continue;let u=d(this,j,o0).call(this,e,a);u&&i.push(d(this,j,r0).call(this,o,n,a,u))}}return i},r0=function(t,e,i,n){return{symbol:i,sprite:n.sprite??null,position:[t,e],dialog:n.dialog??null,isOnScreen:!1,end:n.end??null,sound:n.sound??null,solid:n.solid!==!1,visible:n.visible!==!1,foreground:n.foreground===!0,onCollide:n.onCollide,onEnter:n.onEnter,onLeave:n.onLeave,onScreenEnter:n.onScreenEnter,onScreenLeave:n.onScreenLeave,onTurn:n.onTurn}},o0=function(t,e){let i=t[e];if(i)return typeof i=="function"?i():i},O0),Ot,jt,Te,a0,j0,Js=(j0=class{constructor(t){h(this,Te);h(this,Ot);h(this,jt);l(this,Ot,d(this,Te,a0).call(this,t)),l(this,jt,Oe())}subscribe(t){s(this,jt).subscribe(t)}get(){return d(this,Te,a0).call(this,s(this,Ot))}set(t){for(let[e,i]of Object.entries(t))s(this,Ot)[e]=Array.isArray(i)?[...i]:i;s(this,jt).notify()}},Ot=new WeakMap,jt=new WeakMap,Te=new WeakSet,a0=function(t){let e={};for(let i in t){let n=t[i];n!==void 0&&(e[i]=Array.isArray(n)?[...n]:n)}return e},j0),tt,kt,k0,ti=(k0=class{constructor(t){h(this,tt);h(this,kt);l(this,tt,t),l(this,kt,Oe())}subscribe(t){return s(this,kt).subscribe(t)}get map(){return s(this,tt)}set map(t){l(this,tt,t),s(this,kt).notify(s(this,tt))}get dimensions(){return qs(c0(s(this,tt)))}},tt=new WeakMap,kt=new WeakMap,k0),Ft,Wt,et,st,qe,Ee,it,nt,F0,ei=(F0=class{constructor(t){h(this,Ft);h(this,Wt);h(this,et);h(this,st);h(this,qe);h(this,Ee);h(this,it);h(this,nt,[0,0]);l(this,Ft,t.sprite??null),l(this,Wt,t.position??[0,0]),l(this,et,t.sprite??null),l(this,st,t.position??[0,0]),l(this,qe,t.onTurn),l(this,Ee,t.onInput),l(this,it,Oe())}subscribe(t){return s(this,it).subscribe(t)}saveCurrentState(){l(this,Ft,s(this,et)),l(this,Wt,[...s(this,st)])}restoreSavedState(){l(this,et,s(this,Ft)),l(this,st,[...s(this,Wt)]),s(this,it).notify()}dispatchOnTurn(){var t;(t=s(this,qe))==null||t.call(this,this.facade)}dispatchOnInput(t){var e;(e=s(this,Ee))==null||e.call(this,t)}get sprite(){return s(this,et)}get position(){return s(this,st)}set sprite(t){l(this,et,t),s(this,it).notify()}set position(t){l(this,st,[...t]),s(this,it).notify()}get direction(){return s(this,nt)}setDirection(t){switch(t){case"LEFT":l(this,nt,[-1,0]);break;case"UP":l(this,nt,[0,-1]);break;case"RIGHT":l(this,nt,[1,0]);break;case"DOWN":l(this,nt,[0,1]);break}}get facade(){let t=this;return{get sprite(){return t.sprite},set sprite(e){t.sprite=e},get position(){return t.position},set position(e){t.position=e},get direction(){return t.direction}}}},Ft=new WeakMap,Wt=new WeakMap,et=new WeakMap,st=new WeakMap,qe=new WeakMap,Ee=new WeakMap,it=new WeakMap,nt=new WeakMap,F0),Ut,W0,si=(W0=class{constructor(){h(this,Ut,0)}next(){je(this,Ut)._++}get value(){return s(this,Ut)}reset(){l(this,Ut,0)}},Ut=new WeakMap,W0),ii=t=>{var u;let e=new ti(t.map),i=new Js(((u=t.filter)==null?void 0:u.settings)??{}),n=new ei(t.player),r=new Qs(t,e),o=new si,a=Oe();return i.subscribe(()=>{a.notify()}),n.subscribe(()=>{a.notify()}),r.subscribe(()=>{a.notify()}),{player:n,actors:r,gameMap:e,filterUniforms:i,turn:o,subscribe:a.subscribe}},ni=200,ri=200,C0=30,oi=class{constructor(){x(this,"controls",[]);x(this,"lastKeysEvents",new Map);x(this,"onInput");x(this,"lastPointerEvent",0);x(this,"oldTouchX");x(this,"oldTouchY");x(this,"pointerId");x(this,"isSliding",!1);x(this,"handleTouch",t=>{t.pointerType!=="mouse"&&(this.pointerId=t.pointerId,this.oldTouchX=t.clientX,this.oldTouchY=t.clientY)});x(this,"handleTouchUp",t=>{var e;this.pointerId===t.pointerId&&(this.pointerId=void 0,this.isSliding||((e=this.onInput)==null||e.call(this,"ACTION")),this.isSliding=!1)});x(this,"handleTouchLeave",t=>{this.pointerId===t.pointerId&&(this.pointerId=void 0,this.isSliding=!1)});x(this,"handleTouchMove",t=>{var a,u;if(this.pointerId!==t.pointerId)return;let e=t.clientX,i=t.clientY;if(e===void 0||i===void 0||this.oldTouchX===void 0||this.oldTouchY===void 0)return;let n=e-this.oldTouchX,r=i-this.oldTouchY,o=t.timeStamp;if(!(Math.abs(n)<C0&&Math.abs(r)<C0)&&!(o-this.lastPointerEvent<ri))if(this.lastPointerEvent=o,this.oldTouchX=e,this.oldTouchY=i,this.isSliding=!0,Math.abs(r)>Math.abs(n)){let p=Math.sign(r);(a=this.onInput)==null||a.call(this,p<0?"UP":"DOWN")}else{let p=Math.sign(n);(u=this.onInput)==null||u.call(this,p<0?"LEFT":"RIGHT")}});x(this,"handleKeydown",t=>{var o;let e=this.controls.find(([a,u])=>u===t.code||u.includes(t.code));if(!e)return;let[i]=e,n=t.timeStamp,r=this.lastKeysEvents.get(t.code);t.repeat&&r&&n-r<ni||(this.lastKeysEvents.set(t.code,n),(o=this.onInput)==null||o.call(this,i))});let t=document.createElement("div");t.classList.add("odyc-touchEvent"),t.style.setProperty("position","absolute"),t.style.setProperty("left","0"),t.style.setProperty("height","0"),t.style.setProperty("width","100vw"),t.style.setProperty("height","100vh"),t.style.setProperty("overflow","hidden"),t.style.setProperty("touch-action","none"),t.style.setProperty("z-index","999999999"),document.body.appendChild(t),document.body.style.setProperty("margin","0"),document.addEventListener("keydown",this.handleKeydown),t.addEventListener("pointerdown",this.handleTouch),t.addEventListener("pointerup",this.handleTouchUp),t.addEventListener("pointerleave",this.handleTouchLeave),t.addEventListener("pointercancel",this.handleTouchLeave),t.addEventListener("pointermove",this.handleTouchMove)}static get touchEventElement(){}init(t,e){this.lastKeysEvents.clear(),this.lastPointerEvent=0,this.oldTouchX=void 0,this.oldTouchY=void 0,this.pointerId=void 0,this.isSliding=!1,this.controls=Object.entries(t.controls),this.onInput=e}},ai=p0(()=>new oi),li=(t,e)=>{let i=ai(null);return i.init(t,e),i},hi="odyc-message-canvas",ui=30,G,Y,ze,Bt,rt,Ht,Ae,wt,Ce,ot,Ne,bt,Pe,Se,Vt,S,Xe,Nt,Xt,Ge,hs,U0,ci=(U0=class{constructor(t){h(this,Ge);h(this,G);h(this,Y);x(this,"isOpen",!1);h(this,ze);h(this,Bt,[]);h(this,rt,[]);h(this,Ht);h(this,Ae);h(this,wt,0);h(this,Ce);h(this,ot);h(this,Ne,0);h(this,bt);h(this,Pe);h(this,Se);h(this,Vt);h(this,S,192);h(this,Xe,1);h(this,Nt,2);h(this,Xt,t=>{l(this,ot,requestAnimationFrame(s(this,Xt))),!(t-s(this,Ne)<(s(this,Ce)||ui))&&d(this,Ge,hs).call(this,t)});x(this,"close",()=>{var t;l(this,wt,0),l(this,rt,[]),this.isOpen=!1,s(this,ot)&&cancelAnimationFrame(s(this,ot)),s(this,G).hide(),(t=s(this,ze))==null||t.call(this)});l(this,Pe,t.colors),l(this,Se,Q(t.messageBackground,t.colors)),l(this,Vt,Q(t.messageColor,t.colors)),l(this,Ht,Math.floor((s(this,S)-2*s(this,Xe))/8)),l(this,Ae,Math.floor(s(this,S)/(8+s(this,Nt)))),l(this,Ce,t.messageInternvalMs),l(this,G,Qt({id:hi,zIndex:10})),s(this,G).hide(),l(this,Y,s(this,G).get2dCtx()),s(this,G).setSize(s(this,S),s(this,S)),l(this,bt,new d0(`
`,s(this,Vt),s(this,Pe)))}open(t){var n;let e=typeof t=="string"?[t]:[...t];if(e.length===0||((n=e[0])==null?void 0:n.length)===0)return;this.isOpen=!0,l(this,Bt,e);let i=s(this,Bt)[s(this,wt)];if(i)return l(this,rt,s(this,bt).parseText(i,s(this,Ht))),s(this,G).show(),l(this,ot,requestAnimationFrame(s(this,Xt))),new Promise(r=>l(this,ze,()=>r()))}next(){je(this,wt)._++;let t=s(this,Bt)[s(this,wt)];t?(l(this,rt,s(this,bt).parseText(t,s(this,Ht))),l(this,ot,requestAnimationFrame(s(this,Xt)))):this.close()}},G=new WeakMap,Y=new WeakMap,ze=new WeakMap,Bt=new WeakMap,rt=new WeakMap,Ht=new WeakMap,Ae=new WeakMap,wt=new WeakMap,Ce=new WeakMap,ot=new WeakMap,Ne=new WeakMap,bt=new WeakMap,Pe=new WeakMap,Se=new WeakMap,Vt=new WeakMap,S=new WeakMap,Xe=new WeakMap,Nt=new WeakMap,Xt=new WeakMap,Ge=new WeakSet,hs=function(t){s(this,Y).clearRect(0,0,s(this,S),s(this,S)),s(this,Y).fillStyle=s(this,Se),s(this,Y).fillRect(0,0,s(this,S),s(this,S)),s(this,Y).fillStyle=s(this,Vt);let e=Math.min(s(this,rt).length,s(this,Ae)),i=e*8+(e-1)*s(this,Nt),n=(s(this,S)-i)*.5;for(let r=0;r<e;r++){let o=s(this,rt)[r];if(!o)continue;let a=o.length*8,u=(s(this,S)-a)*.5,p=n+r*8+r*s(this,Nt);s(this,bt).draw(s(this,Y),o,u,p,t)}},U0),di=t=>new ci(t),pi="odyc-prompt-canvas",Pt=384,A=2,P0=28,Qe=10,ee=8,Je=12,Fe=8,We=2,K,_,_e,$,L,Me,Re,Ie,De,w,Be,us,l0,cs,ds,He,B0,mi=(B0=class{constructor(t){h(this,w);h(this,K);h(this,_);h(this,_e);x(this,"isOpen",!1);h(this,$,[]);h(this,L,0);h(this,Me);h(this,Re);h(this,Ie);h(this,De);l(this,Me,t.colors),l(this,Re,d(this,w,He).call(this,t.dialogBackground)),l(this,Ie,d(this,w,He).call(this,t.dialogColor)),l(this,De,d(this,w,He).call(this,t.dialogBorder)),l(this,K,Qt({id:pi,zIndex:10})),s(this,K).setSize(Pt,Pt),s(this,K).hide(),l(this,_,s(this,K).get2dCtx())}async openMenu(t){let e=Object.keys(t),i=e[await this.open(...e)];if(!i||!(i in t))return;let n=t[i];if(n)return typeof n=="function"?n():await this.openMenu(n)}async open(...t){return t.length?(l(this,L,0),this.isOpen=!0,s(this,K).show(),l(this,$,t),d(this,w,l0).call(this),new Promise(e=>{l(this,_e,i=>e(i))})):-1}input(t){let e=Math.ceil(s(this,$).length/A),i=Math.floor(s(this,L)/A),n=s(this,L)-i*A;switch(t){case"LEFT":n=Math.max(0,n-1);break;case"UP":i=Math.max(0,i-1);break;case"RIGHT":n=Math.min(n+1,A-1);break;case"DOWN":i=Math.min(i+1,e-1);break;case"ACTION":d(this,w,us).call(this);return}l(this,L,Math.min(i*A+n,s(this,$).length-1)),d(this,w,l0).call(this)}},K=new WeakMap,_=new WeakMap,_e=new WeakMap,$=new WeakMap,L=new WeakMap,Me=new WeakMap,Re=new WeakMap,Ie=new WeakMap,De=new WeakMap,w=new WeakSet,Be=function(){let t=P0*8+ee*2,e=(Pt-t)*.5,i=Math.floor(Pt/15),n=Math.max(Math.ceil(s(this,$).length/A),2),r=n*Fe+Je*2+Qe*(n-1);return{left:e,top:i,width:t,height:r}},us=function(){var t;this.isOpen=!1,s(this,K).hide(),(t=s(this,_e))==null||t.call(this,s(this,L))},l0=function(){var r;d(this,w,ds).call(this);let{left:t,top:e,width:i}=s(this,w,Be);s(this,_).fillStyle=s(this,Ie);let n=Math.ceil(P0/A-A);for(let o=0;o<s(this,$).length;o++){let a=(r=s(this,$)[o])==null?void 0:r.slice(0,n);if(!a)continue;let u=Math.floor(o/A),p=o-u*A,m=t+ee+p*(i-ee*2)/A+(p+1)*Fe,f=e+Je+8*u+u*Qe;d0.text(s(this,_),a,m,f)}d(this,w,cs).call(this)},cs=function(){let t=Math.floor(s(this,L)/A),e=s(this,L)-t*A,{left:i,top:n,width:r}=s(this,w,Be),o=i+ee+e*(r-ee*2)/A+e*Fe,a=n+Je+8*t+t*Qe;for(let u=0;u<Fe/2;u++)s(this,_).fillRect(o+u,a+u,1,8-2*u)},ds=function(){s(this,_).clearRect(0,0,Pt,Pt),s(this,_).fillStyle=s(this,De);let{left:t,top:e,height:i,width:n}=s(this,w,Be);s(this,_).fillRect(t-We,e-We,n+We*2,i+We*2),s(this,_).fillStyle=s(this,Re),s(this,_).fillRect(t,e,n,i)},He=function(t){return typeof t=="string"?t:s(this,Me)[t]??"black"},B0),xi=t=>new mi(t),fi="odyc-renderer-canvas",E,Tt,se,H0,yi=(H0=class{constructor(t){h(this,Tt);x(this,"canvas");h(this,E,24);x(this,"screenWidth");x(this,"screenHeight");x(this,"cellWidth");x(this,"cellHeight");x(this,"colors");x(this,"ctx");x(this,"background");this.screenWidth=t.screenWidth,this.screenHeight=t.screenHeight,this.cellWidth=t.cellWidth,this.cellHeight=t.cellHeight,this.colors=t.colors,t.background&&(this.background=Q(t.background,this.colors)),this.canvas=Qt({id:fi}),this.canvas.show(),this.ctx=this.canvas.get2dCtx()}render(t,e,i){this.clear();let n=!1;for(let r of e)r.foreground&&r.position[0]===t.position[0]&&r.position[1]===t.position[1]?(d(this,Tt,se).call(this,t,i),d(this,Tt,se).call(this,r,i),n=!0):d(this,Tt,se).call(this,r,i);n||d(this,Tt,se).call(this,t,i)}clear(){this.canvas.setSize(this.cellWidth*this.screenWidth*s(this,E),this.cellHeight*this.screenHeight*s(this,E)),this.background!==void 0&&(typeof this.background=="number"?this.ctx.fillStyle=this.colors[this.background]??this.colors[0]??"black":this.ctx.fillStyle=this.background,this.ctx.fillRect(0,0,this.screenWidth*this.cellWidth*s(this,E),this.screenHeight*this.cellHeight*s(this,E)))}},E=new WeakMap,Tt=new WeakSet,se=function(t,e){var f;if(t.sprite===void 0||t.sprite===null||t.visible===!1||!e.isOnScreen(t.position))return;let[i,n]=t.position,[r,o]=e.position,a=(i-r)*this.cellWidth,u=(n-o)*this.cellHeight;if(a+this.cellWidth<0||u+this.cellHeight<0||a>this.screenWidth*this.cellWidth||u>this.screenHeight*this.cellHeight)return;let p=t.sprite;if(typeof p=="number"||p.length===1){let y=Q(p,this.colors);if(!y)return;this.ctx.fillStyle=y,this.ctx.fillRect(Math.floor(a)*s(this,E),Math.floor(u)*s(this,E),this.cellWidth*s(this,E),this.cellHeight*s(this,E));return}let m=c0(p);for(let y=0;y<this.cellHeight;y++)for(let z=0;z<this.cellWidth;z++){let q=(f=m[y])==null?void 0:f.charAt(z);if(!q)continue;let Jt=Q(q,this.colors);Jt&&(this.ctx.fillStyle=Jt,this.ctx.fillRect(Math.floor(a+z)*s(this,E),Math.floor(u+y)*s(this,E),s(this,E),s(this,E)))}},H0),vi=t=>new yi(t),ps={waveForm:[{name:"waveForm",defaultValue:0,type:"radio",options:[{value:0,label:"Sine"},{value:1,label:"SawTooth"},{value:2,label:"Square"},{value:3,label:"Triangle"}]}],volume:[{name:"volume",min:0,max:1,step:.01,type:"range",defaultValue:.5}],soundEnveloppe:[{name:"attackTime",min:0,max:2,step:.01,type:"range",defaultValue:0},{name:"sustainTime",min:0,max:2,step:.01,type:"range",defaultValue:.07},{name:"sustainPunch",min:0,max:1,step:.01,type:"range",defaultValue:0},{name:"decayTime",min:0,max:2,step:.01,type:"range",defaultValue:.3}],pitch:[{name:"frequency",min:0,max:4e3,step:1,type:"range",defaultValue:700},{name:"pitchDelta",min:-4e3,max:4e3,step:1,type:"range",defaultValue:0},{name:"pitchDuration",min:0,max:1,step:.01,type:"range",defaultValue:1},{name:"pitchDelay",min:0,max:1,step:.01,type:"range",defaultValue:0}],vibrato:[{name:"vibratoRate",min:0,max:70,step:1,type:"range",defaultValue:0},{name:"vibratoDepth",min:0,max:100,step:1,type:"range",defaultValue:0}],tremolo:[{name:"tremoloRate",min:0,max:70,step:1,type:"range",defaultValue:0},{name:"tremoloDepth",min:0,max:1,step:.01,type:"range",defaultValue:0}],filters:[{name:"highPassCutoff",min:0,max:4e3,step:.1,type:"range",defaultValue:0},{name:"highPassResonance",min:0,max:30,step:.1,type:"range",defaultValue:0},{name:"lowPassCutoff",min:0,max:4e3,step:.1,type:"range",defaultValue:4e3},{name:"lowPassResonance",min:0,max:30,step:.1,type:"range",defaultValue:0}],phaser:[{name:"phaserBaseFrequency",min:0,max:1e3,step:1,type:"range",defaultValue:100},{name:"phaserLfoFrequency",min:0,max:200,step:1,type:"range",defaultValue:50},{name:"phaserDepth",min:0,max:1e3,step:1,type:"range",defaultValue:0}],noise:[{name:"noiseAmount",min:0,max:500,step:1,type:"range",defaultValue:0}]},$t=Object.values(ps).flatMap(t=>[...t]),Ke=$t.reduce((t,e)=>({...t,[e.name]:e.defaultValue}),{}),gi=(t,{noiseAmount:e})=>{let i=t.createWaveShaper(),n=44100,r=new Float32Array(n),o=Math.PI/180;for(let a=0;a<n;a++){let u=a*2/n-1;r[a]=(3+Math.random()*e)*u*20*o/(Math.PI+Math.random()*e*Math.abs(u))}return i.curve=r,i.oversample="4x",{input:i,output:i}},wi=(t,{attackTime:e,sustainTime:i,sustainPunch:n,decayTime:r})=>{let o=t.createGain(),a=t.currentTime;return o.gain.setValueAtTime(0,a),o.gain.linearRampToValueAtTime(1-n,a+e),o.gain.setValueAtTime(1,a+e),o.gain.linearRampToValueAtTime(1-n,a+e+i),o.gain.linearRampToValueAtTime(0,a+e+i+r),{input:o,output:o}},bi=(t,{highPassCutoff:e,highPassResonance:i})=>{let n=t.createBiquadFilter();return n.type="highpass",n.frequency.value=e,n.Q.value=i,{input:n,output:n}},Ti=(t,{lowPassCutoff:e,lowPassResonance:i})=>{let n=t.createBiquadFilter();return n.type="lowpass",n.frequency.value=e,n.Q.value=i,{input:n,output:n}},qi=(t,e,i)=>Math.min(Math.max(t,e),i),Ei=(t,e)=>Math.round(t*10**e)/10**e,zi=["sine","sawtooth","square","triangle"],Ai=ps.pitch[0].max,Ci=(t,e,{waveForm:i,frequency:n,pitchDelta:r,pitchDuration:o,pitchDelay:a})=>{let u=e*a,p=(e-u)*o,m=t.createOscillator();return m.type=zi[i]??"sine",m.frequency.setValueAtTime(n,t.currentTime),m.frequency.linearRampToValueAtTime(n,t.currentTime+u),m.frequency.linearRampToValueAtTime(qi(0,n+r,Ai),t.currentTime+u+p),{input:m,output:m,start:()=>m.start(),stop:f=>m.stop(f)}},Pi=(t,{phaserBaseFrequency:e,phaserLfoFrequency:i,phaserDepth:n})=>{let r=t.createBiquadFilter();r.type="allpass",r.frequency.value=e;let o=t.createOscillator();o.type="sine",o.frequency.value=i;let a=t.createGain();return a.gain.value=n,o.connect(a),a.connect(r.frequency),{input:r,output:r,start:()=>o.start(),stop:u=>o==null?void 0:o.stop(u)}},ms=(t,e,i)=>{let n=t.createOscillator(),r=t.createGain();return n.frequency.value=i,r.gain.value=e,n.connect(r),{input:n,output:r,start:()=>n.start(),stop:o=>n.stop(o)}},Si=(t,{tremoloDepth:e,tremoloRate:i})=>ms(t,e,i),_i=(t,{vibratoDepth:e,vibratoRate:i})=>ms(t,e,i),Mi=(t,{volume:e})=>{let i=t.createGain();return i.gain.value=e,{input:i,output:i}},Ri=(t,e,i)=>{let n=Object.assign({},Ke,t),r=n.attackTime+n.sustainTime+n.decayTime,o=Ci(e,r,n),a=gi(e,n),u=wi(e,n),p=_i(e,n),m=Si(e,n),f=Ti(e,n),y=bi(e,n),z=Pi(e,n),q=Mi(e,n);p.output.connect(o.input.frequency),m.output.connect(u.input),o.output.connect(a.input),a.output.connect(z.input),z.output.connect(f.input),f.output.connect(y.input),y.output.connect(u.input),u.output.connect(q.input),q.output.connect(i);let Jt=[p,m,o,z,f,u];return new Promise(ys=>{Jt.forEach(Ct=>{var x0,f0;(x0=Ct.start)==null||x0.call(Ct),(f0=Ct.stop)==null||f0.call(Ct,e.currentTime+r)}),o.output.onended=()=>ys()})},Ii=t=>{var r;let e={...Ke},i=t.searchParams.get("fx");if(!i)return e;let n=decodeURI(i).split(",");for(let o=0;o<$t.length;o++){let a=(r=$t[o])==null?void 0:r.name,u=n[o];a&&u&&!isNaN(Number(u))&&(e[a]=Number(u))}return e},qt,Gt,Yt,Z,Le,h0,V0,Di=(V0=class{constructor(t){h(this,Le);x(this,"seed");h(this,qt);h(this,Gt);h(this,Yt);h(this,Z);this.seed=t??Date.now(),l(this,qt,this.seed&4294967295),l(this,Gt,362436069),l(this,Yt,521288629),l(this,Z,88675123);for(let e=0;e<32;e++)d(this,Le,h0).call(this)}number(t,e){return t===void 0?(t=0,e=1):e===void 0&&(e=t,t=0),t+(e-t)*d(this,Le,h0).call(this)/4294967295}boolean(t=.5){return this.number(0,1)<t}fromArray(t){return t[Math.floor(this.number(0,t.length))]}},qt=new WeakMap,Gt=new WeakMap,Yt=new WeakMap,Z=new WeakMap,Le=new WeakSet,h0=function(){let t=s(this,qt)^s(this,qt)<<11&4294967295;return l(this,qt,s(this,Gt)),l(this,Gt,s(this,Yt)),l(this,Yt,s(this,Z)),l(this,Z,s(this,Z)^s(this,Z)>>>19^(t^t>>>8)),s(this,Z)+2147483648},V0),Li=t=>($t.forEach(e=>{var n;let i=t[e.name];if(e.type==="range"&&i){let r=((n=e.step.toString().split(".")[1])==null?void 0:n.length)??0;t[e.name]=Ei(i,r)}}),Object.assign({},Ke,t)),Oi=(t,e)=>Li(t(new Di(e))),S0={DEFAULT:()=>({}),PICKUP:t=>({...t.boolean()?{pitchDelta:t.number(100,500),pitchDuration:0,pitchDelay:t.number(0,.7)}:{},waveForm:t.fromArray([0,1,2,3]),sustainPunch:t.number(0,.8),sustainTime:t.number(.05,.2),decayTime:t.number(.1,.3),frequency:t.number(900,1700)}),LASER:t=>{let e=t.number(100,1300);return{waveForm:t.fromArray([0,1,2,3]),sustainPunch:t.number(0,.8),sustainTime:t.number(.05,.1),decayTime:t.number(0,.2),frequency:e,pitchDelta:t.number(-e,-100),pitchDuration:1,pitchDelay:t.fromArray([0,t.number(0,.3)])}},JUMP:t=>({waveForm:t.fromArray([1,2]),sustainPunch:t.number(0,.8),sustainTime:t.number(.2,.5),decayTime:t.number(.1,.2),frequency:t.number(100,500),pitchDelta:t.number(200,500),pitchDuration:1,pitchDelay:t.fromArray([0,t.number(0,.3)])}),FALL:t=>{let e=t.number(80,500);return{waveForm:t.fromArray([1,2,3]),sustainPunch:0,sustainTime:t.number(.2,.5),decayTime:t.number(.2,.5),frequency:e,pitchDelta:-e,pitchDuration:1,pitchDelay:t.number(0,.2),vibratoRate:t.number(8,18),vibratoDepth:t.number(10,30),tremoloRate:t.number(5,18),tremoloDepth:t.number(0,1)}},POWERUP:t=>({waveForm:t.fromArray([0,1,2,3]),sustainPunch:t.number(0,1),sustainTime:t.number(.2,.5),decayTime:t.number(.1,.5),frequency:t.number(200,1e3),pitchDelta:t.number(100,300),pitchDuration:1,pitchDelay:t.fromArray([0,t.number(0,.3)]),vibratoRate:t.number(10,18),vibratoDepth:t.number(50,100)}),EXPLOSION:t=>{let e=t.number(200);return{waveForm:t.fromArray([0,1,2,3]),volume:.3,sustainPunch:t.number(0,.3),sustainTime:t.number(.4,1.3),decayTime:t.number(.1,.5),frequency:e,pitchDelta:-e,pitchDuration:1,pitchDelay:t.number(.3),vibratoRate:t.number(0,70),vibratoDepth:t.number(0,100),tremoloRate:t.number(0,70),tremoloDepth:t.number(0,1),phaserDepth:t.number(300,1e3),noiseAmount:t.number(300,500)}},BLIP:t=>({waveForm:t.fromArray([0,1,2,3]),sustainTime:t.number(.02,.1),decayTime:t.number(0,.04),frequency:t.number(600,3e3)}),HIT:t=>{let e=t.number(20,500);return{waveForm:t.fromArray([0,1,2,3]),sustainTime:t.number(.01,.03),sustainPunch:t.number(.5),decayTime:t.number(0,.2),frequency:e,pitchDelta:t.number(-e,-e*.2),noiseAmount:t.number(100)}},FART:t=>{let e=t.number(30,150);return{waveForm:1,volume:.7,sustainPunch:t.number(0,.2),sustainTime:t.number(.1,.5),decayTime:t.number(.3,.5),frequency:e,pitchDelta:-e/2,pitchDuration:1,pitchDelay:.1,vibratoRate:t.number(8,18),vibratoDepth:t.number(10,30),tremoloRate:t.number(35,70),tremoloDepth:t.number(.6,1),lowPassCutoff:e*10,lowPassResonance:10,noiseAmount:t.number(0,30)}},RANDOM:t=>{let e={...Ke};for(let i=0;i<$t.length;i++){let n=$t[i];n&&(n.type==="range"?e[n.name]=t.number(n.min,n.max):n.type==="radio"&&(e[n.name]=t.fromArray(n.options.map(r=>r.value))))}return e}},Et,zt,Kt,Ye,xs,N0,ji=(N0=class{constructor(){h(this,Ye);h(this,Et);h(this,zt);h(this,Kt,!1);l(this,Et,new AudioContext),l(this,zt,s(this,Et).createGain()),s(this,zt).connect(s(this,Et).destination)}set volume(t){s(this,zt).gain.value=t}async play(...t){if(s(this,Kt))return;l(this,Kt,!0);let e=d(this,Ye,xs).call(this,...t);return Ri(e,s(this,Et),s(this,zt)).then(()=>{l(this,Kt,!1)})}},Et=new WeakMap,zt=new WeakMap,Kt=new WeakMap,Ye=new WeakSet,xs=function(...t){let[e,i]=t;return typeof e!="string"?e:Es(e)?Ii(new URL(e)):e in S0?Oi(S0[e],i):{}},N0),ki=p0(()=>new ji),Fi=t=>{let e=ki(null);return e.volume=t.volume,e},Wi=t=>{let e=Object.assign({},Ts,t),i=ii(e),n=Fi(e),r=bs(e),o=vi(e),a=Ws(e),u=xi(e),p=di(e),m=Gs(o.canvas.element,e.filter),f=Us({gameState:i,messageBox:p,camera:r}),y=As(()=>{m==null||m.setUniforms(i.filterUniforms.get()),r.update(i.player.position,i.gameMap.dimensions),o.render(i.player,i.actors.get(),r),i.actors.handleScreenEvents(r),m==null||m.render()},60),z=Zs({gameState:i,soundPlayer:n,dialog:a,ender:f});return li(e,q=>{u.isOpen?u.input(q):p.isOpen?q==="ACTION"&&p.next():a.isOpen?q==="ACTION"&&a.next():(q!=="ACTION"&&z.update(q),i.player.dispatchOnInput(q))}),i.subscribe(y),e.title&&p.open(e.title),y(),Ys(i,a,u,n,f,p)};const Ui=["#212529","#f8f9fa","#ced4da","#228be6","#fa5252","#fcc419","#ff922b","#40c057","#f06595","#a52f01"],Bi="#aaa884",Hi="#6c6c2c",Vi="#fcffa4",Ni="rgba(0, 0, 0, 0.4)",Xi="#000",Gi="#9b9b9b",Yi="#d8d8dc",Ki="#85764d",$i="#0c5ea1",Zi="#1c93f9",Qi="#326591",Ji="#000",tn="#ffd98f",en="#ffb741",sn="#c28400",nn="#c37e00",rn="#000",on="#bd8e47",an="#b36c12",ln="#863200",hn="#1f0000",un="#000",cn="#c9c6c7",dn="#888a87",pn="#54534f",mn="#d89c82",xn=[Bi,Hi,Vi,Xi,Ni,Gi,Yi,Ki,$i,Zi,Qi,rn,on,an,ln,hn,Ji,tn,en,sn,nn,un,cn,dn,pn,mn],fn=[...Ui,...xn],yn=["...........edddddddde...........",".........ddddddddddddd..........","........eddddadddddddde.........","........dddddcbdddddddd.........","........ddddbccbddddddd.........","........dddbcccccccbddd.........","........dbcccccccccccbd.........","........dbcdddcccdddcbd.........",".........dccbcccccbccd..........",".........dccccccaccccd..........","..........ddaccaaccdd...........","...........ddcccccdd............",".........ddggdddddggdd..........",".......ddggggggggggggggdd.......","......dggggggggggggggggggd......",".....dggggggggggggggggggggd.....","....dggggggggggggggggggggggd....","....dgggggdggggggggggdgggggd....","....dccggdggggggggggggdggccd....","...dcccccdggggggggggggdcccccd...","...dccccddkkkkkkkkkkkkddccccd...","....dccd.diiiiiiiiiiiid.dccd....",".....dd..djjjjjijjjjjjd..dd.....",".........djjjjjijjjjjjd.........",".........djjjjjiijjjjjd.........",".........djjjjjddjjjjjd.........",".........djjjjd..djjjjd.........",".........diiiid..diiiid.........","........dhhhhhd..dhhhhhd........",".......dhhhhhhd..dhhhhhhd.......","......dhhhhhhhd..dhhhhhhhd......","......ddddddddd..ddddddddd......"].join(`
`),vn=["................................",".llllllllllllllllllllllllllllll.",".lmmmmmmmmmmmmmmmmmmmmmmmmmmmml.",".lmnnnnnnnnnnnnnnnnnnnnnnnnnnol.",".lmnnnnnnnnnnnnnnnnnnnnnnnnnnol.",".lmnnooooooooooooooooooooonnnol.",".lmnnoppppppppppppppppppppmnnol.",".lmnnopnnpoooooooooooopmnpmnnol.",".lmnnopnnmpoooooooooopmnnpmnnol.",".lmnnopponmpnnnnnnnnpmnoppmnnol.",".lmnnopoponmpmmmmmmpmnopopmnnol.",".lmnnopooponmpmmmmpmnopoopmnnol.",".lmnnopoonponmpmmpmnopnoopmnnol.",".lmnnopoonnponmppmnopnnoopmnnol.",".lmnnopoonnmponmpnopmnnoopmnnol.",".lmnnopoonnmmponmppmmnnoopmnnol.",".lmnnopoonnmmpponmpmmnnoopmnnol.",".lmnnopoonnmpmnponmpmnnoopmnnol.",".lmnnopoonnpmnopponmpnnoopmnnol.",".lmnnopoonpmnopmmponmpnoopmnnol.",".lmnnopoopmnopmmmmponmpoopmnnol.",".lmnnopopmnopnnnnnnponmpopmnnol.",".lmnnoppmnopnnnnnnnnponmppmnnol.",".lmnnopnnopooooooooooponnpmnnol.",".lmnnopnopooooooooooooponpmnnol.",".lmnnoppppppppppppppppppppmnnol.",".lmnnnmmmmmmmmmmmmmmmmmmmmmnnol.",".lmnnnnnnnnnnnnnnnnnnnnnnnnnnol.",".lmnnnnnnnnnnnnnnnnnnnnnnnnnnol.",".lmnnoooooooooooooooooooooooool.",".llllllllllllllllllllllllllllll.","................................"].join(`
`),gn=["................................",".qqqqqqqqqqqqqqqqqqqqqqqqqqqqqq.",".qrrrrrrrrrrrrrrrrrrrrrrrrrrrrq.",".qrsssssssssssssssssssssssssstq.",".qrsssssssssssssssssssssssssstq.",".qrsstttttttttttttttttttttssstq.",".qrsstuuuuuuuuuuuuuuuuuuuursstq.",".qrsstussuttttttttttttursursstq.",".qrsstussrutttttttttturssursstq.",".qrsstuutsrussssssssurstuursstq.",".qrsstututsrurrrrrrurstutursstq.",".qrsstuttutsrurrrrurstuttursstq.",".qrsstuttsutsrurrurstusttursstq.",".qrsstuttssutsruurstussttursstq.",".qrsstuttssrutsrusturssttursstq.",".qrsstuttssrrutsruurrssttursstq.",".qrsstuttssrruutsrurrssttursstq.",".qrsstuttssrursutsrurssttursstq.",".qrsstuttssurstuutsrussttursstq.",".qrsstuttsursturrutsrusttursstq.",".qrsstuttursturrrrutsruttursstq.",".qrsstuturstussssssutsrutursstq.",".qrsstuurstussssssssutsruursstq.",".qrsstusstuttttttttttutssursstq.",".qrsstustuttttttttttttutsursstq.",".qrsstuuuuuuuuuuuuuuuuuuuursstq.",".qrsssrrrrrrrrrrrrrrrrrrrrrsstq.",".qrsssssssssssssssssssssssssstq.",".qrsssssssssssssssssssssssssstq.",".qrsstttttttttttttttttttttttttq.",".qqqqqqqqqqqqqqqqqqqqqqqqqqqqqq.","................................"].join(`
`),wn=["vvxwxxxyvxwxxxxyvvxwxxxyvxwxxxxy","vxwxxxxyvxwxxxxyvxwxxxxyvxwxxxxy","vwxxxxyyvxxxxxyyvwxxxxyyvxxxxxxy","xwxxxyyyvyxxxyyvxwxxxyyyvyxxxyyv","xxxxyyvvvvyyyyyvxxxxyyvvvvyyyyyv","yyyyyvxwwxvvvvvvyyyyyvxwwxvvvvvv","vyyvvxwxxxxxvxwwvyyvvxwxxxxxvxww","wvvxwwxxxxxxvwxxwvvxwwxxxxxxvwxx","xxvxxxxxxxxvxwxxxxvxxxxxxxyvxwxx","xxxvxxxxxxyvwxxxxxxvxxxxxxyvwxxx","xxxvyyxxxxyvwxxxxxxvyyxxxyyvwxxx","xxxyvyyyxyyvxxxxxxxyvyyyxyyvxxxx","xxxyyvvyyyvvyxxxxxxyyvvyyyvvyyxx","xxyyvxxvvvxxvyxxxxxyvxxvvvxxvyyx","yyyvxwxxvxwxxvyyyxyvxwxxvxwxxvyy","yyvxwxxxvxwxxxvvyyvxwxxxvxwxxxvv","vvxwxxxxvxwxxxxxvvxwxxxyvxwxxxxx","vxwxxxxyvxwxxxxyvxwxxxxyvxwxxxxy","vwxxxxxyvxxxxxxyvwxxxxyyvxxxxxyy","xwxxxyyyvyyxxyyvxwxxxyyyvyyxxyyv","xxxxyyvvvvyyyyyvyxxxyyvvvvyyyyyv","yyxyyvxwwxvvvvvvyyxyyvxwwxvvvvvv","vyyvvxwxxxxxvxwwvyyvvxwxxxxxvxww","wvvxwwxxxxxxvwxxwvvxwwxxxxxxvwxx","xxvxxxxxxxxvxwxxxxvxxxxxxxxvxwxx","xxxvxxxxxxyvwxxxxxxvxxxxxxyvwxxx","xxxvyyxxxxyvwxxxxxxvyyxxxxyvwxxx","xxxyvyyyxyyvyxxxxxxyvyyyxyyvxxxx","xxxyyvvyyyvvyyxxxxxyyvvyyyvvyxxx","xxyyvxxvvvxxvyyxxxyyvxxvvvxxvyyx","yyyvxwxxvxwxxvyyxyyvxwxxvxwxxvyy","yyvxwxxxvxwxxxvvyyvxwxxxvxwxxxvv"].join(`
`),bn=["................................","................................","................................","................................","................................","................................","................................","................................","................................","...............zz...............","..............zzzz..............",".............zzzzzz.............","............zzzzzzzz............","...........zzzzzzzzzz...........","..........zzzzzzzzzzzz..........","..........zzzzzzzzzzzz..........","..........zzzzzzzzzzzz..........","...........zzzzzzzzzz...........","............zzzzzzzz............",".............zzzzzz.............","..............zzzz..............","...............zz...............","................................","................................","................................","................................","................................","................................","................................","................................","................................","................................"].join(`
`),fs=t=>Array.isArray(t.sprite)?t.sprite.join(`\r
`):t.sprite,Tn={sprite:["..........","...wwwww..",".www...w..",".wf....w..",".www..fw..",".wtwwc.ww.",".w.wft.fw.",".wc.....w.",".w....f.w.",".wwwwwwww."],startPosition:[5,4]},qn={sprite:["..........","...wwwww..",".www...w..",".wt.c..w..",".www.c.w..",".wtwwc.ww.",".w.w.t..w.",".wc.ccctw.",".w...t..w.",".wwwwwwww."],startPosition:[3,3]},ie=[Tn,qn];let u0=[],lt=0;const m0=(t,e)=>{lt!==e&&(lt=e);const i=ie[e];u0=[],t.loadMap(fs(i),i.startPosition)},En=async t=>{await t.openDialog("Nice job! Going to next level."),lt=(lt+1)%ie.length,m0(t,lt)},C=Wi({cellWidth:32,cellHeight:32,screenWidth:10,screenHeight:10,background:"#e0d8ad",colors:fn,templates:{x:{sprite:2},t:{sprite:bn,solid:!1},f:{sprite:vn},w:{sprite:wn},c:{sprite:gn,onCollide:async function(t){const[e,i]=C.player.position,[n,r]=t.position,o=!!u0.find(({x:f,y})=>f===n&&y===r),[a,u]=[n-e,r-i],p=C.getCell(n+a,r+u),m=p.solid;if(!m){const f=p.symbol==="t";if(f&&(u0.push({x:n+a,y:r+u}),C.playSound("POWERUP",543534)),C.addToCell(n+a,r+u,t.symbol),C.player.position=[n,r],t.remove(),f){let y=!1;for(let z=0;z<C.height;z++)for(let q=0;q<C.width;q++)C.getCell(q,z).symbol==="t"&&(y=!0);y||await En(C)}}o&&!m&&C.addToCell(n,r,"t")}}},map:fs(ie[lt]),player:{sprite:yn,position:ie[lt].startPosition},title:`* Sokoban *\r
\r
\r
\r
\r
Press [space] or [enter]`}),zn=ie.map((t,e)=>({[`Level ${e+1}`]:()=>m0(C,e)})).reduce((t,e)=>({...t,...e})),An={Continue:null,"Change Level":zn,Restart:()=>m0(C,lt)};document.addEventListener("keyup",t=>{t.key==="Escape"&&C.openMenu(An)});
